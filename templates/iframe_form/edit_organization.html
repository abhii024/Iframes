{% load static %}

{% block content %}
<div class="container py-4">
    <div class="settings-panel">
        <h1 class="settings-header">
            <svg class="icon" viewBox="0 0 24 24" width="24" height="24">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                <path d="M11 17h2v-6h-2v6zm-1-12h4v2h-4V5z"/>
            </svg>
            Organization Settings
        </h1>

        <form method="POST" class="settings-form">
            {% csrf_token %}

            <!-- Organization Selection -->
            <div class="form-section">
                <label class="form-label">
                    <svg class="icon" viewBox="0 0 24 24" width="20" height="20">
                        <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
                    </svg>
                    Organization
                </label>
                <select name="organization" id="organization" class="form-select">
                    <option value="">Select an organization</option>
                    {% for org in organizations %}
                        <option value="{{ org.id }}" {% if selected_org and selected_org.id == org.id %}selected{% endif %}>
                            {{ org.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            {% if selected_org %}
            <!-- Field Selection -->
            <div class="form-section">
                <label class="form-label">
                    <svg class="icon" viewBox="0 0 24 24" width="20" height="20">
                        <path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
                        <path d="M7 12h2v5H7zm4-7h2v12h-2zm4 5h2v7h-2z"/>
                    </svg>
                    Form Fields
                </label>
                <select name="fields" id="fields" class="form-select" multiple>
                    {% for field in available_fields %}
                        <option value="{{ field }}" {% if field in selected_fields %}selected{% endif %}>
                            {{ field|title }}
                        </option>
                    {% endfor %}
                </select>
                <div class="form-hint">Select multiple with Ctrl/Cmd</div>
            </div>

            <!-- CSS Editor -->
            <div class="form-section">
                <label class="form-label">
                    <svg class="icon" viewBox="0 0 24 24" width="20" height="20">
                        <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                    </svg>
                    Custom CSS
                </label>
                <textarea name="form_style" id="form_style" class="code-editor">{{ selected_org.form_style }}</textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-save">
                    Save Settings
                </button>
            </div>
            {% endif %}
        </form>
    </div>
</div>

<script>
    document.getElementById('organization').addEventListener('change', function() {
        this.form.submit();
    });
</script>

<style>
    :root {
        --primary: #4a6fa5;
        --primary-light: #e8f0fe;
        --border: #e0e0e0;
        --text: #333;
        --text-light: #666;
    }

    body {
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        color: var(--text);
        line-height: 1.6;
        background-color: #f9fafb;
    }

    .settings-panel {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        padding: 2rem;
    }

    .settings-header {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .form-section {
        margin-bottom: 1.75rem;
    }

    .form-label {
        display: block;
        font-weight: 500;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        background-color: white;
        font-size: 1rem;
        transition: border-color 0.2s;
    }

    .form-select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px var(--primary-light);
    }

    .form-select[multiple] {
        min-height: 120px;
        padding: 0.5rem;
    }

    .form-hint {
        font-size: 0.875rem;
        color: var(--text-light);
        margin-top: 0.25rem;
    }

    .code-editor {
        width: 100%;
        min-height: 200px;
        padding: 1rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 0.875rem;
        line-height: 1.5;
        background-color: #f8f9fa;
    }

    .btn-save {
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .btn-save:hover {
        background-color: #3a5a8f;
    }

    .icon {
        fill: currentColor;
    }

    @media (max-width: 768px) {
        .settings-panel {
            padding: 1.5rem;
            border-radius: 0;
        }
    }
</style>
{% endblock %}